<!DOCTYPE HTML>
<html lang="en">

{{ template "partials/head" . }}

<body>

{{ template "partials/header" . }}

<section class="padding-y bg-light">
    <div class="container">
        <div class="row">
            <main class="col-xl-8 col-lg-8">
                <article class="card">
                    <div class="content-body">
                        <h5 class="card-title">Order Details</h5>
                        <div class="row">
                            <div class="col-6 mb-3">
                                <label class="form-label">First name</label>
                                <input type="text" class="form-control" placeholder="Type here" name="first-name"
                                       disabled value="{{ .order.Customer.FirstName }}">
                            </div>

                            <div class="col-6">
                                <label class="form-label">Last name</label>
                                <input type="text" class="form-control" placeholder="Type here" name="last-name"
                                       disabled value="{{ .order.Customer.LastName }}">
                            </div>

                            <div class="col-6 mb-3">
                                <label class="form-label">Phone</label>
                                <input type="text" class="form-control" placeholder="Type here" name="phone"
                                       disabled value="{{ .order.ShippingAddress.Phone }}">
                            </div>

                            <div class="col-6 mb-3">
                                <label class="form-label">Email</label>
                                <input type="text" class="form-control" placeholder="Type here" name="email" disabled
                                       value="{{ .order.ShippingAddress.Email }}">
                            </div>
                        </div>

                        <hr class="my-4">

                        <h5 class="card-title">Delivery Info</h5>

                        <div class="row">
                            <div class="col-sm-8 mb-3">
                                <label for="" class="form-label">Address</label>
                                <input type="text" class="form-control" placeholder="Type here" name="address" disabled
                                       value="{{ .order.ShippingAddress.Street }}">
                            </div>

                            <div class="col-sm-4 col-6 mb-3">
                                <label for="" class="form-label">Postal code</label>
                                <input type="text" class="form-control" placeholder="Type here" name="postal-code"
                                       disabled value="{{ .order.ShippingAddress.Postcode }}">
                            </div>

                            <div class="col-sm-4 col-6 mb-3">
                                <label for="" class="form-label">City</label>
                                <input type="text" class="form-control" placeholder="Type here" name="city" disabled
                                       value="{{ .order.ShippingAddress.City }}">
                            </div>

                            <div class="col-sm-4 col-6 mb-3">
                                <label for="" class="form-label">State</label>
                                <input type="text" class="form-control" placeholder="Type here" name="state" disabled
                                       value="{{ .order.ShippingAddress.State }}">
                            </div>

                            <div class="col-sm-4 mb-3">
                                <label for="" class="form-label">Country</label>
                                <input type="text" class="form-control" placeholder="Type here" name="state" disabled
                                       value="{{ .order.ShippingAddress.Location.Name }}">
                            </div>

                            <div class="col-sm-6 mb-3">
                                <label for="" class="form-label">Delivery Method</label>
                                <input type="text" class="form-control" placeholder="Type here" name="state" disabled
                                       value="{{ .order.ShippingMethod.DisplayName }}">
                            </div>

                            <div class="col-sm-6 mb-3">
                                <label for="" class="form-label">Payment Method</label>
                                <input type="text" class="form-control" placeholder="Type here" name="state" disabled
                                       value="{{ .order.PaymentMethod.DisplayName }}">
                            </div>
                        </div>

                        <div class="mb-4">
                            <label for="" class="form-label">Message to seller</label>
                            <textarea class="form-control" name="note">{{ .order.Note }}</textarea>
                        </div>

                        <div class="float-end">
                            <input type="submit" class="btn btn-primary" value="Pay Now"/>
                        </div>
                    </div>
                </article>
            </main>

            <aside class="col-xl-4 col-lg-4">
                <article class="ms-lg-4 mt-4 mt-lg-0" style="max-width: 320px">
                    <h6 class="card-title">Summary</h6>

                    <dl class="dlist-align">
                        <dt>Subtotal:</dt>
                        <dd class="text-end" id="subtotal">{{ formatAmount .order.Subtotal }}</dd>
                    </dl>
                    <dl class="dlist-align">
                        <dt>Discount:</dt>
                        <dd class="text-end text-danger" id="discount">-{{ formatAmountR .order.DiscountedAmount }}</dd>
                    </dl>
                    <dl class="dlist-align">
                        <dt>Delivery Fee:</dt>
                        <dd class="text-end" id="delivery-fee">{{ formatAmount .order.ShippingCharge }}</dd>
                    </dl>
                    <dl class="dlist-align">
                        <dt>Payment Processing Fee:</dt>
                        <dd class="text-end" id="delivery-fee">{{ formatAmount .order.PaymentProcessingFee }}</dd>
                    </dl>
                    <hr>
                    <dl class="dlist-align">
                        <dt>Grand Total:</dt>
                        <dd class="text-end"><strong class="text-dark"
                                                     id="grand-total">{{ formatAmount .order.GrandTotal }}</strong></dd>
                    </dl>

                    <div class="input-group my-4">
                        <span>Applied Coupon Code {{ .order.CouponCode.Code }}</span>
                    </div>

                    <hr>

                    <h6 class="mb-4">Items</h6>

                    {{ range $item := .order.Cart.CartItems }}
                        <figure class="itemside align-items-center mb-4">
                            <div class="aside">
                                <b class="badge bg-secondary rounded-pill">{{ $item.Quantity }}</b>
                                <img src="{{ getIndex $item.Product.FullImages 0 }}" class="img-sm rounded border">
                            </div>

                            <figcaption class="info">
                                <a class="title">{{ $item.Product.Name }}</a>
                                <div class="price text-muted">{{ formatAmount $item.PurchasePrice }}</div>
                            </figcaption>
                        </figure>
                    {{end}}
                </article>
            </aside>
        </div>

        <br><br>
    </div>
</section>

<script>
    function onShippingMethodChange(event) {
        let selectEle = document.getElementById('shipping-select')
        if (selectEle !== null) {
            selectEle.remove()
        }

        let targetId = `${event.target.value}`;
        let fee = Number(document.getElementById('sm_fee_' + targetId).value);
        let deliveryFeeEle = document.getElementById('delivery-fee');
        let deliveryFee = (0).toFixed(2);
        if (fee !== 0) {
            deliveryFee = (fee / 100).toFixed(2);
        }
        deliveryFeeEle.innerText = deliveryFee + ' ' + get_currency();

        update_grand_total();
    }

    function update_grand_total() {
        let sub = Number(document.getElementById('subtotal').innerText.replace(get_currency(), "").trim()) * 100
        let delivery = Number(document.getElementById('delivery-fee').innerText.replace(get_currency(), "").trim()) * 100
        let discount = Number(document.getElementById('discount').innerText.replace(get_currency(), "").trim()) * 100
        document.getElementById('grand-total').innerText = ((sub + delivery - discount) / 100).toFixed(2) + ' ' + get_currency();
    }

    function get_currency() {
        return '{{ .shop.Currency }}';
    }

    function on_apply_coupon() {
        let code = document.getElementById('coupon-code').value;
        if (code.trim() === '') {
            return
        }
        let url = window.location.href;
        let queryIndex = url.indexOf("?")
        if (queryIndex >= 0) {
            url = url.substring(0, queryIndex)
        }
        window.location.replace(`${url}?coupon=${code}`)
    }
</script>

{{ template "partials/footer" . }}

</body>
</html>
